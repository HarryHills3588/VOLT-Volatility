text = '''
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOLT Volatility Newsletter - October 2023 Edition</title>
</head>
<body style="font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; color: #333;">

<h3 style="font-size: 24px; margin-bottom: 10px;">VOLT Volatility Newsletter - October 2023 Edition</h3>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Market Overview</strong></h4>
<p>As we navigate through October, the U.S. equity markets exhibit a blend of resilience and uncertainty. The S&P 500 and NASDAQ-100 continue to reach new highs, but the underlying volatility persists due to macroeconomic pressures, interest rate fluctuations, and sector-specific uncertainties. This newsletter will provide an in-depth analysis of current volatility metrics, sector betas, market expectations, and economic indicators that could drive future market movements.</p>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Implied Volatility in S&P 500 Stocks</strong></h4>
<p>Understanding implied volatility (IV) is key to gauging market expectations. In our latest analysis, we've identified both high- and low-volatility stocks within the S&P 500.</p>

<p><strong>Top 5 Stocks by Implied Volatility:</strong></p>
<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
    <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Ticker</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Implied Volatility (IV)</th>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">LRCX</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">131.74%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">GE</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">103.04%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">SMCI</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">93.51%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">ENPH</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">91.92%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">MTD</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">82.94%</td>
    </tr>
</table>

<p><strong>Lowest 5 Stocks by Implied Volatility:</strong></p>
<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
    <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Ticker</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Implied Volatility (IV)</th>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">K</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">10.22%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">AMCR</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">14.27%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">MCD</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">16.72%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">NDSN</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">17.30%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">BAX</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">19.54%</td>
    </tr>
</table>

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Analysis of High Volatility Stocks</strong></h4>
<ul>
    <li><strong>LRCX (Lam Research Corporation)</strong>: The highest IV at 131.74% indicates intense market speculation and potential price swings, presenting opportunities for traders focused on volatility.</li>
    <li><strong>GE (General Electric)</strong>: With an IV of 103.04%, GEâ€™s expected price movement reflects ongoing restructuring efforts and market dynamics.</li>
    <li><strong>SMCI (Super Micro Computer, Inc.)</strong>: A strong IV of 93.51% showcases bullish sentiment tied to high-performance computing demand.</li>
    <li><strong>ENPH (Enphase Energy)</strong>: The IV of 91.92% suggests heightened awareness of regulatory impacts on the renewable energy sector.</li>
    <li><strong>MTD (Mettler-Toledo International)</strong>: With IV at 82.94%, this stock reflects uncertainty in healthcare and research-related markets.</li>
</ul>

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Low Volatility Insights</strong></h4>
<p>Low IV stocks like <strong>K (Keurig Dr Pepper)</strong> and <strong>AMCR (Amcor)</strong>, with values below 15%, indicate a market expectation of stability, potentially appealing for conservative investors.</p>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>SPY Volatility Term Structure</strong></h4>
<p>Examining the SPY ETF, which tracks the S&P 500, reveals a declining trend in IV across various time horizons:</p>
<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
    <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Time Horizon</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Implied Volatility (IV)</th>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">30-day</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">16.02%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">60-day</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">15.82%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">90-day</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">15.51%</td>
    </tr>
</table>

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Market Sentiment Analysis</strong></h4>
<ul>
    <li>The 30-day IV is the highest at 16.02%, indicating short-term uncertainty, while the 90-day IV decreases to 15.51%, suggesting a more stable outlook over the medium term.</li>
    <li>A declining IV may reflect bullish sentiment, as traders expect less market volatility going forward.</li>
</ul>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Earnings Impact on Volatility</strong></h4>
<p>As we approach earnings season, certain stocks are attracting attention due to high IV surrounding their announcements:</p>
<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
    <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Ticker</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Earnings Date</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Implied Volatility (IV)</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Implied Move (%)</th>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">GE</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2024-10-22</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">103.04%</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">13.57%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">STX</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2024-10-22</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">70.44%</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2.39%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">CCI</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2024-10-16</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">64.01%</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">4.02%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">PPG</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2024-10-16</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">62.76%</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">4.03%</td>
    </tr>
</table>

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Key Insights</strong></h4>
<ul>
    <li><strong>General Electric (GE)</strong> leads the list, hinting at significant expected volatility post-announcement.</li>
    <li>Comparatively, <strong>STX</strong> shows lower anticipated movement, indicating relative stability in earnings expectations.</li>
</ul>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Economic Indicators and Market Implications</strong></h4>
<p>Upcoming economic indicators will play a crucial role in shaping market volatility, including:</p>
<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
    <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Indicator</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Release Date</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Previous Value</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Estimate</th>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">Retail Sales Ex Autos MoM (Sep)</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2024-10-17</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">0.1</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">0.1</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">Retail Sales YoY (Sep)</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2024-10-17</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2.1</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">1.6</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">Continuing Jobless Claims (Oct/05)</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">2024-10-17</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">1861.0</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">1870.0</td>
    </tr>
</table>

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Analysis of Retail Sales</strong></h4>
<p>A stronger retail sales figure could boost market sentiment, while a decrease may introduce volatility as concerns over consumer spending arise.</p>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Treasury Yields and Interest Rate Environment</strong></h4>
<p>Current U.S. Treasury yields indicate shifting market expectations regarding interest rates.</p>
<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
    <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Maturity</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Today (10/15)</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">One Week Ago (10/07)</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">One Month Ago (09/16)</th>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">1 Month</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">4.93%</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">5.00%</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">5.11%</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">10 Year</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">4.03%</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">4.03%</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">3.63%</td>
    </tr>
</table>

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Yield Insights</strong></h4>
<ul>
    <li>Short-term yields are declining, reflecting a shift in expectations towards a more accommodative monetary policy.</li>
    <li>A lower yield environment may enhance demand for riskier assets, potentially amplifying market movements.</li>
</ul>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Sector Betas and Volatility</strong></h4>
<p>Understanding sector betas can help investors navigate volatility, as higher betas indicate greater sensitivity to market fluctuations.</p>
<table style="width: 100%; border-collapse: collapse; margin: 10px 0;">
    <tr>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Sector</th>
        <th style="border: 1px solid #ddd; padding: 8px; text-align: left; background-color: #f2f2f2;">Beta</th>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">Technology</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">1.22</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">Health Care</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">0.67</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">Consumer Discretionary</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">1.29</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">Consumer Staples</td>
        <td style="border: 1px solid #ddd; padding: 8px; text-align: left;">0.58</td>
    </tr>
</table>

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Sector Insights</strong></h4>
<ul>
    <li><strong>Technology and Consumer Discretionary</strong> sectors are notably volatile, while <strong>Health Care and Consumer Staples</strong> offer more stability, appealing to more risk-averse investors.</li>
</ul>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<h4 style="font-size: 20px; margin-top: 20px; margin-bottom: 10px;"><strong>Conclusion</strong></h4>
<p>The landscape of market volatility is complex, influenced by earnings reports, economic indicators, and changes in interest rates. The current data points to a market that is cautiously optimistic, with declining implied volatility in the SPY and a gradual decrease in Treasury yields. However, heightened volatility in select sectors and stocks indicates that investors should remain vigilant.</p>
<p>As we move forward, monitoring these trends will be crucial for making informed investment decisions. Stay tuned for further insights in our next edition!</p>

<hr style="border: 1px solid #ccc; margin: 20px 0;">

<p><strong>Disclaimer:</strong> This newsletter is for informational purposes only and is not financial advice. Always conduct your own research or consult with a financial advisor before making investment decisions.</p>

</body>
</html>
'''

from dotenv import load_dotenv
import os
from supabase import create_client
import pandas as pd
from sendgrid import SendGridAPIClient
from sendgrid.helpers.mail import Mail

load_dotenv('.env')
supaUrl = os.getenv('SUPA_URL')
supaKey = os.getenv('SUPA_KEY')

supabase = create_client(supaUrl,supaKey)
data = supabase.table('emails').select('email').execute()
df = pd.DataFrame(data.data)
emailList = df['email'].tolist()

print(emailList)

message = Mail(
    from_email='Volt@voltvolatility.com',
    to_emails=emailList,
    subject='Your Weekly Volt Volatility Newsletter',
    html_content=text)

try:
    sg = SendGridAPIClient(os.getenv('EMAIL_KEY'))
    response = sg.send(message)
    print(response.status_code)
    print(response.body)
    print(response.headers)
except Exception as e:
    print(e)